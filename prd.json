{
  "title": "Reconcile User Resource with API",
  "description": "Align User resource and related code with the Trustgrid API UserModel. Remove fields that do not exist in the API and ensure correct mapping.",
  "branchName": "fix-user-resource-schema",
  "tasks": [
    {
      "description": "Update tg/user.go to match UserModel API schema",
      "prompt": "Update `tg/user.go`. `User` struct should have `Email` (string, json:email), `PolicyIDs` ([]string, json:policyIds), `Status` (string, json:status). Remove `FirstName`, `LastName`, `Phone`, `Admin`, `Active`. Note: `Status` is 'active' or 'inactive'. Keep `UID` as it is needed for ID.",
      "subagent_type": "ralph"
    },
    {
      "description": "Update hcl/user.go to match new tg.User",
      "prompt": "Update `hcl/user.go`. `User` struct should align with new `tg.User`. Remove `first_name`, `last_name`, `phone`, `admin`, `active` attributes. Add `policy_ids` (list of strings) and `status` (string). Update `UpdateFromTG` and `ToTG` functions accordingly.",
      "subagent_type": "ralph"
    },
    {
      "description": "Update resource/user.go to match new hcl.User",
      "prompt": "Update `resource/user.go`. Remove `first_name`, `last_name`, `phone`, `admin`, `active` fields from schema. Add `policy_ids` (TypeList, Elem string, Optional) and `status` (TypeString, Optional, Default 'active', ValidateFunc for enum). Update `Create`, `Update` logic if needed (majordomo should handle it if struct matches).",
      "subagent_type": "ralph"
    },
    {
      "description": "Update datasource/user.go to match new structure",
      "prompt": "Update `datasource/user.go` and `datasource/users.go` to match the new User schema. Ensure fields like `first_name` etc are removed and replaced with `status`, `policy_ids`.",
      "subagent_type": "ralph"
    },
    {
      "description": "Fix User acceptance tests",
      "prompt": "Update `acctests/user_test.go` to use the new schema fields. Remove references to `first_name` etc. Test `status` and `policy_ids`.",
      "subagent_type": "ralph"
    },
    {
      "description": "Review GroupMembership payload",
      "prompt": "Check `resource/group_membership.go`. Ensure that `Create` method sends the correct payload to `/v2/group/{id}/members`. The `GroupMember` API schema has `user` field. If the current code sends `email`, verify if it should be `user` (containing email) or just `email`. If uncertain, assume `user` key is safer if `GroupMember` schema has `user`. Update if necessary.",
      "subagent_type": "ralph"
    }
  ]
}
